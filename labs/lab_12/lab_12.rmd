---
title: "lab_12"
author: "derek willis"
date: "2023-05-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## You will need

* tidytext and our usual libraries

## Load libraries and establish settings

**Task** Create a codeblock and load appropriate packages and settings for this lab.

```{r}
library(tidyverse)
library(tidytext)
library(janitor)
library(lubridate)
library(rvest)
library(janitor)
library(dplyr)
library(stringr)
```


## Questions

**Q1.** You've been assigned to report a story about the leading reasons that Maryland attorneys get sanctioned by the state for misconduct. The state [publishes lists of sanctions](https://www.courts.state.md.us/attygrievance/sanctions) that contain a short text description about the situation. Load the CSV file in the data folder containing records from fiscal year 2011 onwards. Make a list of unique words from the text column, then following the example in the pre_lab, remove common "stop words" from that list and create a list of the top 10 words containing the percentage of occurrences each word represents. What's the leading word in that answer and, broadly, what do you think the top 10 words describe?

**A1.** The top word that shows up over 500 times is "trust". The words in my top 10, after filtering some words out, all seem to center around misconduct of attorneys. I'm assuming "account" is mostly used in the context of someone's account of the events that took place. Words like "disbarred", "suspension", "reprimand" all seem of negative connotation, which makes sense for a collection of releases about attorneys getting sanctioned for misconduct. I chose to take out the words I did because I don't think "attorney", "client" nor "respondent" don't tell us much about anything. "Failing" I am still unsure if I should leave that in as I type this, but it showed up so much more (over 1000 times more) then any other word. I decided to leave failed and took out failing to still have that word somewhat represented in the dataframe, but I felt as if the major outlier needed to be taken out to see a better scope of unique words. This may be wrong, but usually when working in data frames, we tend to take out the outliers to see a better picture. 

```{r}
md_attorney_sanctions <- read_csv("data/md_attorney_sanctions.csv")

unique_words <- md_attorney_sanctions %>% select(text) %>%
  unnest_tokens(word, text)

data("stop_words")

stop_words <- stop_words %>%
  add_row(word = "attorney") %>% 
  add_row(word = "client") %>% 
  add_row(word = "respondent") %>%
  add_row(word = "respondents") %>%
  add_row(word = 'clients') %>% 
  add_row(word = "failed") %>%
  add_row(word = "failing")

unique_words %>%
  anti_join(stop_words) %>%
  group_by(word) %>%
  tally(sort=TRUE) %>%
  mutate(percent = (n/sum(n))*100) %>%
  top_n(10)
```

**Q2.** Let's move beyond single words to phrases. Make a list of the top 10 three-word phrases, called trigrams, based on the example from the pre_lab (you'll need to modify the example code to do this). What's the top trigram and how often does it appear? What does that phrase mean in legal terms?

**A2.** "Conduct involving dishonesty" and "Dishonesty fraud deceit" were tied for the top spot, both appearing 155 times. Conduct involving dishonesty seems pretty self explanatory referring to attorneys doing something dishonest. In legal terms, it is used to describe behavior that involves deception, fraud or dishonesty. Examples of this could be lying in court, embezzling funds and so on.  However, "dishonesty fraud deceit" isn't as clear. I googled it, chatgpted it and nothing made sense. I asked chatgpt what "dishonesty fraud deceit" meant and it broke it down into individual words. Then it clicked that this isn't a phrase, its a list. In most cases, it probably reads "dishonesty, fraud, deceit" as a list of wrong things not one collective phrase. I'm not sure of this means we should take it out of our list because we are looking for actual phrases or not... or maybe this is a phrase and I am a dumb dumb. 

I'm just going to leave all of that^ in there so you can see the evolution of my thought process but now I went and looked at the actual releases (or whatever they are technically) and looked at the context in which the 'phrase' is used. It is almost always used in the context "engaging in conduct involving dishonesty, fraud, deceit or misrepresentation" In legal terms, it seems a broad term to cover any type of action or behavior that was perceived to be deceiving and unlawful.

```{r}
trigram_dataframe <- md_attorney_sanctions %>%
  unnest_tokens(trigram, text, token = "ngrams", n = 3) %>%
  separate(trigram, c("word1", "word2", "word3"), sep = " ") %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word) %>%
  filter(!word3 %in% stop_words$word) %>%
  mutate(trigram = paste(word1, word2, word3, sep=" ")) %>%
  group_by(trigram) %>%
  tally(sort=TRUE) %>%
  mutate(percent = (n/sum(n))*100) 
```


**Q3.** Let's drop back down to more traditional text analysis - take the top trigram from Q2 and write code to see how many times it occurs in the text column in each fiscal year. What do you think the answer produced by your code suggests? What else could you do to try and clarify the most important reasons attorneys get sanctioned?

**A3.** The count for "conduct involving dishonesty" continues to go up every year a little from 2012-2018 and then takes a big spike in 2019. Either one or two things are true because of this: 1.) This phrase/word wasn't that common and then all the sudden got way more used for one reason or another after 2018. 2.) Way more attorneys started commiting conduct related to dishonesty after 2018. If so, why? COVID started in 2020 so it can't be that... abd even if it was, why would attorneys start committing more dishonesty during a global pandemic? Maybe attorneys started getting watched by a closer eye after 2018, and some type of agency really started cracking down on misconduct involving attorneys. 

```{r}
trigram_count <- md_attorney_sanctions %>%
  filter(str_detect(text, "conduct involving dishonesty")) %>%
  group_by(fiscal_year) %>%
  summarise(count= n())
```
